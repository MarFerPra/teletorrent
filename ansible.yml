---
- hosts: default
  remote_user: marco
  sudo: yes
  vars:
   BOT_TOKEN: "{{ lookup('env','BOT_TOKEN') }}"
   DB_PASSWORD: "{{ lookup('env','DB_PASSWORD')}}"
   DB_USER: "{{ lookup('env','DB_USER')}}"
  tasks:
  - name: Updating repositories
    command: apt-get update
  - name: Installing essential libs
    command: apt-get install -y build-essential
  - name: Installing git
    command: apt-get install -y git
  - name: Installing pip
    command: apt-get install -y python-pip
  - name: Update pip
    command: pip install --upgrade pip
  - name: Installing nodejs
    command: apt-get install -y nodejs
  - name: Installing npm
    command: apt-get install -y npm
  - name: Updating node
    command: npm install npm@latest -g
  - name: Setting up nodejs
    command: ln -s /usr/bin/nodejs /usr/bin/node
  - name: Cloning project repository
    shell: rm -rf teletorrent && git clone https://github.com/MarFerPra/teletorrent
  - name: Installing Teletorrent dependencies
    command: cd teletorrent/
    command: mkdir -p database
    command: npm install --silent
